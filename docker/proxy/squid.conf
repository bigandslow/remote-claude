# Remote Claude - Squid Proxy Configuration
# Domain allowlist for network isolation

# Basic settings
http_port 3128
visible_hostname rc-proxy

# Access control lists
acl localnet src 172.16.0.0/12  # Docker networks
acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 443         # https
acl CONNECT method CONNECT

# Deny requests to unsafe ports
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports

# ============================================================
# DOMAIN ALLOWLIST
# Only these domains are accessible from Claude containers
# ============================================================

# GitHub (git operations, API)
acl allowed_domains dstdomain .github.com
acl allowed_domains dstdomain .githubusercontent.com
acl allowed_domains dstdomain .githubassets.com

# Python packages
acl allowed_domains dstdomain .pypi.org
acl allowed_domains dstdomain .pythonhosted.org

# Node.js packages
acl allowed_domains dstdomain .npmjs.org
acl allowed_domains dstdomain .npmjs.com
acl allowed_domains dstdomain registry.npmjs.org
acl allowed_domains dstdomain registry.yarnpkg.com

# Go packages
acl allowed_domains dstdomain proxy.golang.org
acl allowed_domains dstdomain sum.golang.org
acl allowed_domains dstdomain .golang.org

# Rust packages
acl allowed_domains dstdomain .crates.io
acl allowed_domains dstdomain static.crates.io

# GCP APIs (for service account auth)
acl allowed_domains dstdomain .googleapis.com
acl allowed_domains dstdomain accounts.google.com
acl allowed_domains dstdomain oauth2.googleapis.com

# Common CDNs for package downloads
acl allowed_domains dstdomain .cloudflare.com
acl allowed_domains dstdomain .fastly.net

# ============================================================
# ACCESS RULES
# ============================================================

# Allow access to allowlisted domains only
http_access allow localnet allowed_domains

# Deny everything else
http_access deny all

# Logging
access_log daemon:/var/log/squid/access.log squid
cache_log /var/log/squid/cache.log

# Disable caching (we're just proxying)
cache deny all

# Timeouts
connect_timeout 30 seconds
read_timeout 60 seconds
